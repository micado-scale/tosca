tosca_definitions_version: tosca_simple_yaml_1_2

imports:
- common.yaml


node_types:

  # Custom Kubernetes resource type
  #
  # This type can be used to define *any* Kubernetes resource
  tosca.nodes.MiCADO.Kubernetes:
    description: Base type for defining custom Kubernetes resources
    derived_from: tosca.nodes.Root
    interfaces:
      Kubernetes:
        type: tosca.interfaces.MiCADO.Kubernetes

  # Container node types
  #
  # You can find the following node types below:
  #   * tosca.nodes.MiCADO.Container.Application.Docker.Deployment
  #   * tosca.nodes.MiCADO.Container.Application.Docker.DaemonSet
  #



  # An abstraction of the above node for cleaner TOSCA templates
  tosca.nodes.MiCADO.Container.Application.Docker.Deployment:
    description: An abstraction of the Docker container node, creates a Kubernetes Deployment
    derived_from: tosca.nodes.MiCADO.Container.Application.Docker

    # Fill the artifact by default with the image property
    artifacts:
      image:
        type: tosca.artifacts.Deployment.Image.Container.Docker
        file: { get_property: [ SELF, image ] }
        repository: docker_hub

    # Use these interface inputs by default
    interfaces:
      Kubernetes:
        type: tosca.interfaces.MiCADO.Kubernetes
        create:
          inputs:
            kind: Deployment
            spec:
              strategy:
                type: Recreate

  tosca.nodes.MiCADO.Container.Application.Docker.DaemonSet:
    description: An abstraction which creates a Kubernetes DaemonSet
    derived_from: tosca.nodes.MiCADO.Container.Application.Docker
    artifacts:
      image:
        type: tosca.artifacts.Deployment.Image.Container.Docker
        file: { get_property: [ SELF, image ] }
        repository: docker_hub
    interfaces:
      Kubernetes:
        type: tosca.interfaces.MiCADO.Kubernetes
        create:
          inputs:
            kind: DaemonSet

  tosca.nodes.MiCADO.Container.Pod.Kubernetes:
    description: A bare Kubernetes Pod, which supports hosting containers
    derived_from: tosca.nodes.Container.Runtime
    properties:
    interfaces:
      Kubernetes:
        type: tosca.interfaces.MiCADO.Kubernetes
    requirements:
      - service:
          capability: tosca.capabilities.Container.Docker
          node: tosca.nodes.MiCADO.Container.Application.Docker
          relationship: tosca.relationships.MiCADO.ConnectsTo
      - container:
          capability: tosca.capabilities.Container.Docker
          node: tosca.nodes.MiCADO.Container.Application.Docker
          relationship: tosca.relationships.HostedOn
      - host:
          capability: tosca.capabilities.Compute
          node: tosca.nodes.MiCADO.Compute
          relationship: tosca.relationships.HostedOn

  tosca.nodes.MiCADO.Container.Pod.Kubernetes.Deployment:
    description: An abstraction of the above, creates a Deployment
    derived_from: tosca.nodes.MiCADO.Container.Pod.Kubernetes
    interfaces:
      Kubernetes:
        type: tosca.interfaces.MiCADO.Kubernetes
        create:
          inputs:
            kind: Deployment
            spec:
              strategy:
                type: Recreate

  tosca.nodes.MiCADO.Container.Config.Kubernetes:
    description: An abstraction of the config node for Kubernetes ConfigMaps
    derived_from: tosca.nodes.MiCADO.Container.Config
    description: base type for Config files
    properties:
      data:
        type: map
        description: data
        required: false
      binaryData:
        type: map
        description: datab
        required: false
    capabilities:
      volume:
        type: tosca.capabilities.Attachment
    interfaces:
      Kubernetes:
        type: tosca.interfaces.MiCADO.Kubernetes
        create:
          inputs:
            data: { get_property: [ SELF, data ] }
            binaryData: { get_property: [ SELF, binaryData ] }

  tosca.nodes.MiCADO.Container.Volume.EmptyDir:
    description: An abstraction of the volume node for Kubernetes EmptyDir volumes
    derived_from: tosca.nodes.MiCADO.Container.Volume
    description: description of a Kubernetes HostPath Volume
    capabilities:
      volume:
        type: tosca.capabilities.Attachment
    interfaces:
      Kubernetes:
        type: tosca.interfaces.MiCADO.Kubernetes
        create:
          inputs:
            spec:
              emptyDir: {}

  tosca.nodes.MiCADO.Container.Volume.HostPath:
    description: An abstraction of the volume node for Kubernetes HostPath volumes
    derived_from: tosca.nodes.MiCADO.Container.Volume
    description: description of a Kubernetes HostPath Volume
    properties:
      path:
        type: string
        description: path on host
        required: true
    capabilities:
      volume:
        type: tosca.capabilities.Attachment
    interfaces:
      Kubernetes:
        type: tosca.interfaces.MiCADO.Kubernetes
        create:
          inputs:
            spec:
              hostPath:
                path: { get_property: [ SELF, path ] }

  tosca.nodes.MiCADO.Container.Volume.NFS:
    description: An abstraction of the volume node for Kubernetes NFS volumes
    derived_from: tosca.nodes.MiCADO.Container.Volume
    description: description of a Kubernetes NFS Volume
    properties:
      path:
        type: string
        description: path on host
        required: true
      server:
        type: string
        description: NFS server IP
        required: true
    capabilities:
      volume:
        type: tosca.capabilities.Attachment
    interfaces:
      Kubernetes:
        type: tosca.interfaces.MiCADO.Kubernetes
        create:
          inputs:
            spec:
              nfs:
                path: { get_property: [ SELF, path ] }
                server: { get_property: [ SELF, server ] }

  tosca.nodes.MiCADO.Container.Volume.GlusterFS:
    description: An abstraction of the volume node for Kubernetes GlusterFS volumes
    derived_from: tosca.nodes.MiCADO.Container.Volume
    description: description of a Kubernetes GFS Volume
    properties:
      path:
        type: string
        description: path on host
        required: true
      endpoints:
        type: string
        description: NFS server IP
        required: true
      readOnly:
        type: boolean
        required: false
    capabilities:
      volume:
        type: tosca.capabilities.Attachment
    interfaces:
      Kubernetes:
        type: tosca.interfaces.MiCADO.Kubernetes
        create:
          inputs:
            spec:
              glusterfs:
                path: { get_property: [ SELF, path ] }
                endpoints: { get_property: [ SELF, endpoints ] }
                readOnly: { get_property: [ SELF, readOnly ] }

